_devbox() {
    local cur prev opts
    COMPREPLY=()
    cur=`_get_cword`
    prev=${COMP_WORDS[COMP_CWORD-1]}
    opts="switch list"

    _expand || return 0

    case "$prev" in
    	switch)
    		COMPREPLY=( $(compgen -W "$(ls --color=never /var/vagrant/sites-available | tr -d /)" -- ${cur}) )
    		return 0
    		;;
    	*)
    		COMPREPLY=( $(compgen -W "switch list" -- ${cur}) )
    		return 0
    		;;
    esac
}
complete -F _devbox devbox

if [ "$#" -eq 0 ]; then
	exit 1
else
	case $1 in
		switch)
			if [ "$#" -gt 1 ]; then
				if [[ $(ls /var/vagrant/sites-available) =~ $2 ]]; then
					echo "Switching active host profile to $2..."
					rm /var/vagrant/www
					ln -s /var/vagrant/sites-available/$2 /var/vagrant/www
				else
					echo "$2 is not a known profile. Exiting."
					exit 0
				fi
			else
				echo "No dev library was provided. No action taken."
				exit 0
			fi
			;;
		list)
			ls /var/vagrant/sites-available
			;;
		*)
			/usr/bin/vagrant $1
			;;
	esac
fi